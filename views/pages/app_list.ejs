<!DOCTYPE html>
<html lang="en">
<head>
    <title>Bootstrap Case</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.0.1/fullcalendar.min.css">
    <link rel="stylesheet" media="print" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.0.1/fullcalendar.print.css">
    <script src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.14.1/moment.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.0.1/fullcalendar.min.js"></script>
    <script src="https://use.fontawesome.com/0a0307d764.js"></script>
</head>

<style>
    .navbar {
        margin-bottom: 0;
        background-color: #006600;
        z-index: 9999;
        border: 0;
        font-size: 12px !important;
        line-height: 1.42857143 !important;
        letter-spacing: 4px;
        border-radius: 0;
        font-family: Montserrat, sans-serif;
    }
    .navbar li a, .navbar .navbar-brand {
        color: #fff !important;
    }
    .navbar-nav li a:hover, .navbar-nav li.active a {
        color: #006600 !important;
        background-color: #fff !important;
    }
    .navbar-default .navbar-toggle {
        border-color: transparent;
        color: #fff !important;
    }
    h2 {
        font-size: 24px;
        text-transform: uppercase;
        color: #303030;
        font-weight: 600;
        margin-bottom: 30px;
    }
    h4 {
        font-size: 19px;
        line-height: 1.375em;
        color: #303030;
        font-weight: 400;
        margin-bottom: 30px;
    }
    .jumbotron {
        background-color: #006600;
        color: #fff;
        padding: 25px 25px;
        font-family: Montserrat, sans-serif;
    }
</style>

<script>
    var json = <%-data%>;
    console.log("json = " + json);
    json = JSON.parse(JSON.stringify(json).split('"username":').join('"title":'));
    json = JSON.parse(JSON.stringify(json).split('"Time":').join('"start":'));
    console.log("title: " + json[0].username);
    console.log("start: " + json[0].start);

    $(document).ready(function() {

        $('#calendar').fullCalendar({
            header: {
                left: 'prev,next today',
                center: 'title',
                right: 'month,agendaWeek,agendaDay'
            },
            defaultDate: moment(),
            defaultView: 'agendaWeek',
            navLinks: true, // can click day/week names to navigate views
            selectable: true,
            selectHelper: true,
            select: function(start, end) {
                var title = '<%-data.user%>';
                var eventData;
                if (title) {
                    eventData = {
                        title: title,
                        start: start,
                        end: end
                    };
                    window.location = '/supporter/'
                    $('#calendar').fullCalendar('renderEvent', eventData, true); // stick? = true
                }
                $('#calendar').fullCalendar('unselect');
            },
            eventRender: function(event, element) {
                element.find(".fc-bg").css("pointer-events", "none");
                element.append("<div id= 'btnDeleteEvent' class='fa fa-times' style='position: absolute; bottom:0px;right:0px'></div>");
                element.find("#btnDeleteEvent").click(function () {
                    alert(event.title);
                    window.location = '/supporter/removeEvent?username=' + event.title;
                    $('#calendar').fullCalendar('removeEvents', event._id);
                })
            },
//            eventRender: function(event, element) {
//                element.append( "<span class='closeon'>X</span>" );
//                element.click(function() {
//                    $('#calendar').fullCalendar('removeEvents',event._id);
//                });
//            },
//                eventClick: function(calEvent, jsEvent, view) {
//                    /**
//                     * calEvent is the event object, so you can access it's properties
//                     */
//                    if(confirm("Really delete event " + calEvent.title + " ?")) {
//                        // delete event in backend
//                        jQuery.post(
//                            "/supporter/deleteEvent"
//                            , { "title": calEvent.title }
//                        );
//                        // delete in frontend
//                        $('#calendar').fullCalendar('removeEvents', calEvent._id);
//                    }
//                },
            editable: true,
            eventLimit: true, // allow "more" link when too many events

            events: json
        });

    });

</script>

<body>

<nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/supporter/home">BINGE WebApp</a>
        </div>

        <div class="collapse navbar-collapse" id="myNavbar">
            <ul class="nav navbar-nav navbar-right">
                <li><a href="/add/user">Create a Patient</a></li>
                <li><a href="/appointment">Appointments</a></li>
                <li><a href="#">Notes</a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="jumbotron text-center">
    <h1>Calendar</h1>
    <p>View/Edit Appointment</p>
</div>

<div class="container" id='calendar'></div>

</body>
</html>

